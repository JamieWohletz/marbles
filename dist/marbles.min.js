!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.marbles=e():n.marbles=e()}(this,function(){return function(n){function e(r){if(t[r])return t[r].exports;var o=t[r]={exports:{},id:r,loaded:!1};return n[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var t={};return e.m=n,e.c=t,e.p="",e(0)}([function(n,e,t){"use strict";function r(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i=t(1),u=function n(e){function t(n,e){return n.replace(E,function(n){return e[n.replace(":","")]})}function u(n,e){var t=n.match(new RegExp(E.source,"g"))||[];return(e.match(w)||[]).reduce(function(n,e,r){return n[t[r].replace(":","")]=e,(0,i.assign)((0,i.emptyObject)(),n)},(0,i.emptyObject)())}function c(n){var e=n.replace(new RegExp(E.source,"g"),w.source);return new RegExp(e)}function f(n,e){for(var t=e;t;){if(t.id===n)return t;t=t.next}return null}function a(n,e){for(var t=(0,i.emptyObject)(),r=(0,i.isObject)(e)?e:{data:{}},o=n;o&&o!==r;)(0,i.assign)(t,o.data),o=o.next;return(0,i.assign)(t,r.data)}function s(n,e){var r=e[n];return(0,i.assign)((0,i.emptyObject)(),r,{id:n,segment:t(r.segment,r.data),next:null})}function l(n,e,t){function r(e,t,o){var u=o[t];(e===t||u.dependency===e||n)&&(u.active=!1,u.data=(0,i.emptyObject)()),u.children.forEach(function(n){return r(e,n,o)})}var o=(0,i.cloneDeep)(t);return r(e,e,o),o}function p(n,e,t){function r(n,t,i){var u=o[t],c=o[n];return t===n&&i?(c.active=!0,c.data=e,!0):!(t===n&&!i)&&u.children.reduce(function(e,t){return r(n,t,e)},i||t===c.dependency)}var o=(0,i.cloneDeep)(t),u=(0,i.keys)(o).filter(function(e){return o[e].children.indexOf(n)!==-1}),c=r(n,"root",!1);return c?u.reduce(function(e,t){return e[t].children.filter(function(e){return e!==n}).reduce(function(n,e){return l(!0,e,n)},e)},o):o}function d(n,e){for(var t=(0,i.cloneDeep)(e),r=t,o=void 0,u=!1;r;)u=u||r.id===n.dependency,o=r,r=r.next;return u&&(o.next=(0,i.cloneDeep)(n)),t}function y(n,e){function t(n,e,r,o){var f=o[e];return f.children.reduce(function(e,f){var a=o[f],s=e,l=n.match(c(a.segment))||[],d=l.index?l.index+l[0].length:0;return r[f]?s:(r[f]=!0,l.length>0&&(o[a.dependency]||(0,i.emptyObject)()).active&&(s=p(f,u(a.segment,(0,i.arrayHead)(l)),o)),t(n.substr(d),f,r,s))},o)}var r=(0,i.cloneDeep)(e);return t(n,"root",{},r)}function h(n){return y(n,S)}function v(n){for(var e="#",t=n;t;)t.segment&&(e+=t.segment+"/"),t=t.next;return e}function b(n,e,t,r){var o=n[e],u=s(e,n),c=o.active?d(u,t):(0,i.cloneDeep)(t);return o.children.reduce(function(e,t){return r[t]?e:(r[t]=!0,b(n,t,e,r))},c)}function m(n){var e=(0,i.peek)(k);return e&&JSON.stringify(e)===JSON.stringify(n)||k.push(n),n}function g(n){return n?b(n,"root",s("root",n),(0,i.emptyObject)()):null}function O(n,e,t){var r=g(e),o=g(t),i=function(){for(var n=r,e=[];n;)f(n.id,o)||e.push(n.id),n=n.next;return e}();i.forEach(function(e){n[e].forEach(function(n){n.removed()})});for(var u=o;u;){for(var c=n[u.id],s=0;s<c.length;s++)c[s].inserted(a(o,u));u=u.next}}function x(n,e,t){var r=t;if(!(0,i.isString)(e)||!S[e])return null;(null===t||"object"!==("undefined"==typeof t?"undefined":o(t))||t instanceof Array)&&(r=(0,i.emptyObject)());var u=h(j.location.hash),c=void 0;return c=n?p(e,r,u):l(!1,e,u),j.location.hash=v(g(c)),this}var j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;r(this,n);var S=e,E=/:[a-zA-Z]+(?=\/?)/,w=/\d+(?=\/?)/,D=(0,i.keys)(S).reduce(function(n,e){return n[e]=[],n},(0,i.emptyObject)()),k=[];this.subscribe=function(n){if(!(0,i.isObject)(n))return!1;var e=(0,i.keys)(n).filter(function(n){return!!D[n]});return 0!==e.length&&(e.forEach(function(e){var t=n[e];D[e].push({inserted:t.inserted||i.noop,removed:t.removed||i.noop})}),!0)},this.unsubscribe=function(n,e,t){if(!((0,i.isString)(n)&&(0,i.isString)(e)&&(0,i.isFunction)(t)&&D[n]))return!1;var r=D[n].filter(function(n){return n[e]===t});return(0,i.pull)(r,D[n])},this.insert=function(n,e){return x.call(this,!0,n,e)},this.remove=function(n){return x.call(this,!1,n)},this.getData=function(){return a(g(h(j.location.hash)))},this.step=function(){var n=j.location.hash,e=h(n);return O(D,k.pop(),e),m(e),j.history.replaceState((0,i.emptyObject)(),"",v(g(e))),this};var A=this.step.bind(this);this.start=function(){return j.addEventListener("hashchange",A),this},this.stop=function(){return j.removeEventListener("hashchange",A),this}};e.default=u},function(n,e){"use strict";function t(){return Object.create(null)}function r(n){return"object"===("undefined"==typeof n?"undefined":y(n))&&null!==n&&!(n instanceof Array)}function o(n){return"string"==typeof n}function i(n){return"function"==typeof n}function u(n){return Object.keys(n)}function c(n){return JSON.parse(JSON.stringify(n))}function f(){for(var n=arguments.length,e=Array(n),t=0;t<n;t++)e[t]=arguments[t];return Object.assign.apply(this,e)}function a(n){if("undefined"!=typeof n&&n instanceof Array)return n[0]}function s(n,e){return n.map(function(n){for(var t=e.indexOf(n),r=[];t!==-1;)r=r.concat(e.splice(t,1)),t=e.indexOf(n);return r}).reduce(function(n,e){return n.concat(e)},[]).reduce(function(n,e){return n.indexOf(e)!==-1?n:n.concat(e instanceof Array?[e]:e)},[])}function l(n,e){var t=e.slice();return s(n,t),t}function p(n){return n&&n instanceof Array?n[n.length-1]||null:null}function d(){}Object.defineProperty(e,"__esModule",{value:!0});var y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};e.emptyObject=t,e.isObject=r,e.isFunction=i,e.isString=o,e.noop=d,e.keys=u,e.peek=p,e.cloneDeep=c,e.assign=f,e.arrayHead=a,e.pull=s,e.without=l}])});
//# sourceMappingURL=marbles.min.js.map